{"version":3,"file":"flat-land-gl.js","sources":["../lib/calc.js","../node_modules/tslib/tslib.es6.js","../lib/converter/string.js","../lib/webgl/program.js","../lib/painter/painter.js","../lib/painter/background/background.js","../lib/webgl/color.js","../lib/painter/clear.js","../lib/painter/sprites/sprite.js","../lib/painter/sprites/sprites.js","../lib/painter/sprites/sprites.vert","../lib/painter/sprites/sprites.frag","../lib/painter/index.js","../lib/atlas.js","../lib/pointer.js","../lib/webgl/resize.js","../lib/scene.js","../lib/index.js"],"sourcesContent":["// tslint:disable:no-bitwise\nvar FULL_TURN = 4096;\nvar MODULO = FULL_TURN - 1;\nvar HALF_TURN = 2048;\nvar COS = new Float32Array(FULL_TURN);\nvar SIN = new Float32Array(FULL_TURN);\n// Prepare acceleration table for COS and SIN.\nfor (var i = 0; i < FULL_TURN; i++) {\n    var angle = (Math.PI * i) / HALF_TURN;\n    COS[i] = Math.cos(angle);\n    SIN[i] = Math.sin(angle);\n}\nexport default { cos: cos, sin: sin };\n/**\n * Fast cosine.\n * Angle is define between 0 and 4095.\n * * PI/2  <=>  1023\n * * PI  <=>  2047\n * * 3*PI/2  <=>  3071\n */\nfunction cos(angle) {\n    return COS[(angle | 0) & MODULO];\n}\n/**\n * Fast sine.\n * Angle is define between 0 and 4095.\n * * PI/2  <=>  1023\n * * PI  <=>  2047\n * * 3*PI/2  <=>  3071\n */\nfunction sin(angle) {\n    return SIN[(angle | 0) & MODULO];\n}\n//# sourceMappingURL=calc.js.map","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","// tslint:disable:no-any\n// tslint:disable:no-unsafe-any\nexport default function castString(value, defaultValue) {\n    if (defaultValue === void 0) { defaultValue = ''; }\n    var t = typeof value;\n    if (t === 'number' && !isNaN(value)) {\n        return \"\" + value;\n    }\n    if (t === 'string') {\n        return value;\n    }\n    return defaultValue;\n}\n//# sourceMappingURL=string.js.map","import { __values } from \"tslib\";\nvar BPE = Float32Array.BYTES_PER_ELEMENT;\nvar DIM1 = 1;\nvar DIM2 = 2;\nvar DIM3 = 3;\nvar DIM4 = 4;\n/**\n * Creating  a  WebGL  program  for shaders  is  painful.  This  class\n * simplifies the process.\n *\n * @class Program\n *\n * Object properties starting with `$` are WebGL uniforms or attributes.\n * Uniforms behave as expected: you can read/write a value.\n * Attributes when read, return the location. And when written, enable/disabled\n * this attribute. So you read integers and writte booleans.\n *\n * @param gl - WebGL context.\n * @param codes  - Object  with two  mandatory attributes:  `vert` for\n * vertex shader and `frag` for fragment shader.\n * @param  includes  -  (optional)  If  defined,  the  `#include  foo`\n * directives  of  shaders   will  be  replaced  by   the  content  of\n * `includes.foo`.\n */\nvar Program = /** @class */ (function () {\n    function Program(gl, _codes, includes) {\n        if (includes === void 0) { includes = {}; }\n        var codes = parseIncludes(_codes, includes);\n        this.gl = gl;\n        Object.freeze(this.gl);\n        this.BPE = BPE;\n        Object.freeze(this.BPE);\n        this._typesNamesLookup = getTypesNamesLookup(gl);\n        var shaderProgram = gl.createProgram();\n        if (!shaderProgram) {\n            throw Error('Unable to create WebGLProgram!');\n        }\n        this.program = shaderProgram;\n        var vertShader = getVertexShader(gl, codes.vert);\n        gl.attachShader(shaderProgram, vertShader);\n        var fragShader = getFragmentShader(gl, codes.frag);\n        gl.attachShader(shaderProgram, fragShader);\n        gl.linkProgram(shaderProgram);\n        this.use = function () {\n            gl.useProgram(shaderProgram);\n        };\n        this.attribs = this.createAttributes();\n        this.uniforms = this.createUniforms();\n    }\n    Program.prototype.use = function () {\n        this.gl.useProgram(this.program);\n    };\n    Program.prototype.getTypeName = function (typeId) {\n        return this._typesNamesLookup[typeId];\n    };\n    Program.prototype.bindAttribs = function (buffer) {\n        var e_1, _a, e_2, _b;\n        var names = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            names[_i - 1] = arguments[_i];\n        }\n        var that = this;\n        var gl = this.gl;\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n        var totalSize = 0;\n        try {\n            for (var names_1 = __values(names), names_1_1 = names_1.next(); !names_1_1.done; names_1_1 = names_1.next()) {\n                var name_1 = names_1_1.value;\n                var attrib = that.attribs[name_1];\n                if (!attrib) {\n                    throw Error(\"Cannot find attribute \\\"\" + name_1 + \"!\\nIt may be not active because unused in the shader.\\nAvailable attributes are: \" + Object.keys(that.attribs)\n                        .map(function (n) {\n                        return \"\\\"\" + n + \"\\\"\";\n                    })\n                        .join(', ') + \" (\" + String(that.attribs.length) + \")\");\n                }\n                totalSize += attrib.size * attrib.length * BPE;\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (names_1_1 && !names_1_1.done && (_a = names_1.return)) _a.call(names_1);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n        var offset = 0;\n        try {\n            for (var names_2 = __values(names), names_2_1 = names_2.next(); !names_2_1.done; names_2_1 = names_2.next()) {\n                var name_2 = names_2_1.value;\n                var attrib = that.attribs[name_2];\n                gl.enableVertexAttribArray(attrib.location);\n                gl.vertexAttribPointer(attrib.location, attrib.size * attrib.length, gl.FLOAT, false, // No normalisation.\n                totalSize, offset);\n                offset += attrib.size * attrib.length * BPE;\n            }\n        }\n        catch (e_2_1) { e_2 = { error: e_2_1 }; }\n        finally {\n            try {\n                if (names_2_1 && !names_2_1.done && (_b = names_2.return)) _b.call(names_2);\n            }\n            finally { if (e_2) throw e_2.error; }\n        }\n    };\n    Program.prototype.setUniform = function (name, value) {\n        var id = \"$\" + name;\n        var map = this;\n        map[id] = value;\n    };\n    Program.prototype.createAttributes = function () {\n        var _a = this, gl = _a.gl, program = _a.program;\n        var attribs = {};\n        var attribsCount = gl.getProgramParameter(program, gl.ACTIVE_ATTRIBUTES);\n        for (var index = 0; index < attribsCount; index++) {\n            var item = gl.getActiveAttrib(program, index);\n            if (!item) {\n                continue;\n            }\n            item.typeName = this.getTypeName(item.type);\n            item.length = this.getSize(gl, item);\n            item.location = gl.getAttribLocation(program, item.name);\n            attribs[item.name] = item;\n            Object.defineProperty(this, \"$\" + item.name, {\n                value: item.location,\n                writable: false,\n                enumerable: true,\n                configurable: false,\n            });\n        }\n        return attribs;\n    };\n    Program.prototype.getSize = function (gl, item) {\n        switch (item.type) {\n            case gl.FLOAT_VEC4:\n                return DIM4;\n            case gl.FLOAT_VEC3:\n                return DIM3;\n            case gl.FLOAT_VEC2:\n                return DIM2;\n            case gl.FLOAT:\n                return DIM1;\n            default:\n                throw Error(\"[webgl.program:getSize] I don't know the size of the attribute \\\"\" + item.name + \"\\\" because I don't know the type \\\"\" + this.getTypeName(item.type) + \"\\\"!\");\n        }\n    };\n    Program.prototype.createUniforms = function () {\n        var _a = this, gl = _a.gl, program = _a.program;\n        var uniforms = {};\n        var uniformsCount = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\n        for (var index = 0; index < uniformsCount; index++) {\n            var item = gl.getActiveUniform(program, index);\n            if (!item) {\n                continue;\n            }\n            var location_1 = gl.getUniformLocation(program, item.name);\n            if (!location_1) {\n                continue;\n            }\n            uniforms[item.name] = location_1;\n            Object.defineProperty(this, \"$\" + item.name, {\n                set: this.createUniformSetter(item, uniforms[item.name], this._typesNamesLookup),\n                get: this.createUniformGetter(item),\n                enumerable: true,\n                configurable: false,\n            });\n        }\n        return uniforms;\n    };\n    Program.prototype.createUniformSetter = function (item, nameGL, lookup) {\n        var gl = this.gl;\n        var nameJS = \"_$\" + item.name;\n        switch (item.type) {\n            case gl.BYTE:\n            case gl.UNSIGNED_BYTE:\n            case gl.SHORT:\n            case gl.UNSIGNED_SHORT:\n            case gl.INT:\n            case gl.UNSIGNED_INT:\n            case gl.SAMPLER_2D: // For textures, we specify the texture unit.\n                if (item.size === 1) {\n                    return function (v) {\n                        gl.uniform1i(nameGL, v);\n                        this[nameJS] = v;\n                    };\n                }\n                else {\n                    return function (v) {\n                        gl.uniform1iv(nameGL, v);\n                        this[nameJS] = v;\n                    };\n                }\n            case gl.FLOAT:\n                if (item.size === 1) {\n                    return function (v) {\n                        gl.uniform1f(nameGL, v);\n                        this[nameJS] = v;\n                    };\n                }\n                else {\n                    return function (v) {\n                        gl.uniform1fv(nameGL, v);\n                        this[nameJS] = v;\n                    };\n                }\n            case gl.FLOAT_VEC2:\n                if (item.size === 1) {\n                    return function (v) {\n                        gl.uniform2fv(nameGL, v);\n                        this[nameJS] = v;\n                    };\n                }\n                else {\n                    throw Error(\"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_VEC2 in uniform \\\"\" + item.name + \"\\\"!\");\n                }\n            case gl.FLOAT_VEC3:\n                if (item.size === 1) {\n                    return function (v) {\n                        gl.uniform3fv(nameGL, v);\n                        this[nameJS] = v;\n                    };\n                }\n                else {\n                    throw Error(\"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_VEC3 in uniform \\\"\" + item.name + \"\\\"!\");\n                }\n            case gl.FLOAT_VEC4:\n                if (item.size === 1) {\n                    return function (v) {\n                        gl.uniform4fv(nameGL, v);\n                        this[nameJS] = v;\n                    };\n                }\n                else {\n                    throw Error(\"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_VEC4 in uniform \\\"\" + item.name + \"\\\"!\");\n                }\n            case gl.FLOAT_MAT3:\n                if (item.size === 1) {\n                    return function (v) {\n                        gl.uniformMatrix3fv(nameGL, false, v);\n                        this[nameJS] = v;\n                    };\n                }\n                else {\n                    throw Error(\"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_MAT3 in uniform \\\"\" + item.name + \"\\\"!\");\n                }\n            case gl.FLOAT_MAT4:\n                if (item.size === 1) {\n                    return function (v) {\n                        gl.uniformMatrix4fv(nameGL, false, v);\n                        this[nameJS] = v;\n                    };\n                }\n                else {\n                    throw Error(\"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_MAT4 in uniform \\\"\" + item.name + \"\\\"!\");\n                }\n            default:\n                throw Error(\"[webgl.program.createWriter] Don't know how to deal with uniform \\\"\" + item.name + \"\\\" of type \" + lookup[item.type] + \"!\");\n        }\n    };\n    Program.prototype.createUniformGetter = function (item) {\n        var name = \"_$\" + item.name;\n        return function () {\n            return this[name];\n        };\n    };\n    return Program;\n}());\nexport default Program;\n/**\n * This is a preprocessor for shaders.\n * Directives  `#include`  will be  replaced  by  the content  of  the\n * correspondent attribute in `includes`.\n */\nfunction parseIncludes(codes, includes) {\n    return {\n        vert: parseInclude(codes.vert, includes),\n        frag: parseInclude(codes.frag, includes),\n    };\n}\nfunction parseInclude(code, includes) {\n    return code\n        .split('\\n')\n        .map(function (line) {\n        if (!line.trim().startsWith('#include')) {\n            return line;\n        }\n        var pos = line.indexOf('#include') + '#include'.length;\n        var includeName = line.substr(pos).trim();\n        // We accept all this systaxes:\n        // #include foo\n        // #include 'foo'\n        // #include <foo>\n        // #include \"foo\"\n        if ('\\'<\"'.indexOf(includeName.charAt(0)) > -1) {\n            includeName = includeName.substr(1, includeName.length - '<>'.length);\n        }\n        var snippet = includes[includeName];\n        if (typeof snippet !== 'string') {\n            console.error(\"Include <\" + includeName + \"> not found in \", includes);\n            throw Error(\"Include not found in shader: \" + includeName);\n        }\n        return snippet;\n    })\n        .join('\\n');\n}\nfunction getShader(type, gl, code) {\n    if (type !== gl.VERTEX_SHADER && type !== gl.FRAGMENT_SHADER) {\n        throw Error('Type must be VERTEX_SHADER or FRAGMENT_SHADER!');\n    }\n    var shader = gl.createShader(type);\n    if (!shader) {\n        throw Error(\"Unable to create a \" + (type === gl.VERTEX_SHADER ? 'VERTEX' : 'FRAGMENT') + \" shader!\");\n    }\n    gl.shaderSource(shader, code);\n    gl.compileShader(shader);\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n        console.error(\"An error occurred compiling the shader: \" + gl.getShaderInfoLog(shader));\n        // tslint:disable-next-line:no-console\n        console.info(\"Here is your buggy shader's code:\");\n        // tslint:disable-next-line:no-console\n        console.info(code);\n        throw Error(\"Unable to create a \" + (type === gl.VERTEX_SHADER ? 'VERTEX' : 'FRAGMENT') + \" shader!\");\n    }\n    return shader;\n}\nfunction getFragmentShader(gl, code) {\n    return getShader(gl.FRAGMENT_SHADER, gl, code);\n}\nfunction getVertexShader(gl, code) {\n    return getShader(gl.VERTEX_SHADER, gl, code);\n}\nfunction getTypesNamesLookup(gl) {\n    var lookup = {};\n    for (var k in gl) {\n        if (k !== k.toUpperCase()) {\n            continue;\n        }\n        var v = gl[k];\n        if (typeof v === 'number') {\n            lookup[v] = k;\n        }\n    }\n    return lookup;\n}\n//# sourceMappingURL=program.js.map","import { __values } from \"tslib\";\nimport Program from '../webgl/program';\nvar Painter = /** @class */ (function () {\n    function Painter() {\n        this._programs = [];\n        this._scene = null;\n    }\n    Object.defineProperty(Painter.prototype, \"scene\", {\n        get: function () {\n            return this._scene;\n        },\n        set: function (scene) {\n            if (scene === this._scene) {\n                return;\n            }\n            if (this._scene) {\n                this.internalDestroy(this._scene);\n            }\n            this._scene = scene;\n            if (scene) {\n                this.initialize(scene);\n            }\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Painter.prototype.createProgram = function (shaders, includes) {\n        if (includes === void 0) { includes = {}; }\n        var scene = this._scene;\n        if (!scene) {\n            throw Error('This painter has no scene!\\ncreateProfram() should only be called from initialize().');\n        }\n        var prg = new Program(scene.gl, shaders, includes);\n        this._programs.push(prg);\n        return prg;\n    };\n    Painter.prototype.fatal = function (message) {\n        console.error(\"Fatal error in Painter:\", message);\n        return new Error(message);\n    };\n    Painter.prototype.internalDestroy = function (scene) {\n        var e_1, _a;\n        var gl = scene.gl;\n        try {\n            for (var _b = __values(this._programs), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var prg = _c.value;\n                gl.deleteProgram(prg);\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n    };\n    return Painter;\n}());\nexport default Painter;\n//# sourceMappingURL=painter.js.map","/**\n * Background the screen by filling it with an image that covers it entirely.\n */\nimport { __extends } from \"tslib\";\nimport castString from '../../converter/string';\nimport Painter from '../painter';\nvar NB_VERTICES_IN_SQUARE = 4;\nvar BackgroundPainter = /** @class */ (function (_super) {\n    __extends(BackgroundPainter, _super);\n    /**\n     * params: { atlas, align }\n     * - align: if undefined, the background will be centered.\n     *          \"R\" means that the Right edge of the background is always visible.\n     *          \"L\" means the same for Left.\n     *          \"T\" for Top.\n     *          \"B\" for \"Bottom\".\n     */\n    function BackgroundPainter(params) {\n        var _this = _super.call(this) || this;\n        _this.params = params;\n        return _this;\n    }\n    BackgroundPainter.prototype.render = function () {\n        var _a = this, scene = _a.scene, prg = _a.prg, atlas = _a.atlas, buff = _a.buff;\n        if (!scene || !prg || !atlas || !buff) {\n            return;\n        }\n        var gl = scene.gl;\n        gl.enable(gl.DEPTH_TEST);\n        prg.use();\n        atlas.activate();\n        var uniforms = prg;\n        uniforms.$uniTexture = 0;\n        prg.setUniform('uniAspectRatio', scene.width / scene.height);\n        prg.bindAttribs(buff, 'attXY');\n        gl.bindBuffer(gl.ARRAY_BUFFER, buff);\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, NB_VERTICES_IN_SQUARE);\n    };\n    BackgroundPainter.prototype.destroy = function (scene) {\n        var gl = scene.gl;\n        var buff = this.buff;\n        if (!buff) {\n            return;\n        }\n        gl.deleteBuffer(buff);\n    };\n    BackgroundPainter.prototype.initialize = function (scene) {\n        var params = this.params;\n        var atlas = params.atlas;\n        this.atlas = atlas;\n        this.prg = this.createProgram({\n            frag: FRAG,\n            vert: getVert(castString(params.align).toUpperCase()),\n        });\n        var gl = scene.gl;\n        var buff = gl.createBuffer();\n        if (!buff) {\n            throw this.fatal('Not enough memory to create an array buffer!');\n        }\n        gl.bindBuffer(gl.ARRAY_BUFFER, buff);\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]), gl.STATIC_DRAW);\n        this.buff = buff;\n    };\n    return BackgroundPainter;\n}(Painter));\nexport default BackgroundPainter;\nfunction getVert(align) {\n    var x = '';\n    var y = '';\n    if (align.indexOf('B') !== -1) {\n        y = 'location.y -= uniAspectRatio - 1.0;';\n    }\n    else if (align.indexOf('T') !== -1) {\n        y = 'location.y += uniAspectRatio - 1.0;';\n    }\n    if (align.indexOf('R') !== -1) {\n        x = 'location.x -= 1.0 / uniAspectRatio - 1.0;';\n    }\n    else if (align.indexOf('L') !== -1) {\n        x = 'location.x += 1.0 / uniAspectRatio - 1.0;';\n    }\n    return \"uniform float uniAspectRatio;\\nattribute vec2 attXY;\\nvarying vec2 varUV;\\n\\nvoid main() {\\n  varUV = attXY;\\n  vec2 location = 2.0 * (attXY - vec2(0.5, 0.5));\\n\\n  if (uniAspectRatio > 1.0) {\\n    location.y *= uniAspectRatio;\" + y + \"\\n  } else {\\n    location.x /= uniAspectRatio;\" + x + \"\\n  }\\n\\n  gl_Position = vec4(location.x, -location.y, -1.0, 1.0);\\n}\";\n}\nvar FRAG = \"precision mediump float;\\nuniform sampler2D uniTexture;\\nvarying vec2 varUV;\\n\\nvoid main() {\\n  vec4 color = texture2D( uniTexture, varUV );\\n  gl_FragColor = color;\\n}\";\n//# sourceMappingURL=background.js.map","// tslint:disable:no-magic-numbers\n// tslint:disable:ban\nimport { __read, __values } from \"tslib\";\n/**\n * Fast color manipulations.\n * Attributes R  (red), G  (green), B  (blue), A  (alpha), H  (hue), S\n * (saturation), and L (luminance) are all floats between 0 and 1.\n */\nvar CODE_CSS_LENGTHS = ['#RGB'.length, '#RGBA'.length, '#RRGGBB'.length, '#RRGGBBAA'.length];\nvar RX_HEX_COLOR = /^#[0-9A-F]+$/gi;\nvar LUMINANCE_THRESHOLD = 0.6;\nvar Color = /** @class */ (function () {\n    function Color(codeCSS) {\n        if (codeCSS === void 0) { codeCSS = '#000000'; }\n        this.R = 0;\n        this.G = 0;\n        this.B = 0;\n        this.H = 0;\n        this.S = 0;\n        this.L = 0;\n        this.A = 1;\n        this.parse(codeCSS);\n    }\n    /**\n     * A code CSS is valid if it starts with a '#' and has a length of 3, 4, 6 or 8.\n     */\n    Color.isValid = function (codeCSS) {\n        var e_1, _a;\n        RX_HEX_COLOR.lastIndex = -1;\n        if (!RX_HEX_COLOR.test(codeCSS)) {\n            return false;\n        }\n        try {\n            for (var CODE_CSS_LENGTHS_1 = __values(CODE_CSS_LENGTHS), CODE_CSS_LENGTHS_1_1 = CODE_CSS_LENGTHS_1.next(); !CODE_CSS_LENGTHS_1_1.done; CODE_CSS_LENGTHS_1_1 = CODE_CSS_LENGTHS_1.next()) {\n                var len = CODE_CSS_LENGTHS_1_1.value;\n                if (codeCSS.length === len) {\n                    return true;\n                }\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (CODE_CSS_LENGTHS_1_1 && !CODE_CSS_LENGTHS_1_1.done && (_a = CODE_CSS_LENGTHS_1.return)) _a.call(CODE_CSS_LENGTHS_1);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n        return false;\n    };\n    Color.normalize = function (codeCSS) {\n        var color = new Color(codeCSS);\n        return color.stringify();\n    };\n    Color.luminance = function (codeCSS) {\n        var color = new Color(codeCSS);\n        return color.luminance();\n    };\n    /**\n     * Returns 1 for bright colors and 0 for dark colors.\n     */\n    Color.luminanceStep = function (codeCSS) {\n        var color = new Color(codeCSS);\n        return color.luminanceStep();\n    };\n    Color.fromArrayRGB = function (rgb) {\n        var _a = __read(rgb, 3), R = _a[0], G = _a[1], B = _a[2];\n        return Color.newRGB(R, G, B);\n    };\n    Color.fromArrayRGBA = function (rgba) {\n        var _a = __read(rgba, 4), R = _a[0], G = _a[1], B = _a[2], A = _a[3];\n        return Color.newRGBA(R, G, B, A);\n    };\n    /**\n     * Mix two colors. alpha should be between 0 and 1,\n     * but there is no check on this.\n     * If alpha is 0, the resulting color is `color1`,\n     * if alpha is 1, the resulting color is `color2`.\n     */\n    Color.mix = function (color1, color2, alpha) {\n        if (alpha === void 0) { alpha = 0.5; }\n        var beta = 1 - alpha;\n        return Color.newRGBA(alpha * color2.R + beta * color1.R, alpha * color2.G + beta * color1.G, alpha * color2.B + beta * color1.B, alpha * color2.A + beta * color1.A);\n    };\n    /**\n     * If `colors` has only two elements, this method is the same as `mix()`.\n     * Otherwise, it will perform a linear blending through the colors.\n     * If alpha is 0, the resulting color is `colors[0]`,\n     * If alpha is 1, the resulting color is `colors[colors.length - 1]`,\n     */\n    Color.ramp = function (colors, alpha) {\n        if (alpha === void 0) { alpha = 0.5; }\n        if (colors.length === 0) {\n            return Color.newBlack();\n        }\n        if (colors.length === 1) {\n            return colors[0];\n        }\n        var spacesCount = colors.length - 1;\n        var firstColorIndex = Math.floor(alpha * spacesCount);\n        var color1 = colors[firstColorIndex];\n        if (firstColorIndex === spacesCount) {\n            return color1;\n        }\n        var color2 = colors[firstColorIndex + 1];\n        var translatedAlpha = firstColorIndex + alpha / spacesCount;\n        return Color.mix(color1, color2, translatedAlpha);\n    };\n    Color.newBlack = function () {\n        return Color.newRGB(0, 0, 0);\n    };\n    Color.newWhite = function () {\n        return Color.newRGB(1, 1, 1);\n    };\n    /**\n     * Create a new Color instance base on R,G,B channels.\n     *\n     * @param red - Value between 0 and 1.\n     * @param green - Value between 0 and 1.\n     * @param blue - Value between 0 and 1.\n     * @returns New instance of Color.\n     */\n    Color.newRGB = function (red, green, blue) {\n        var color = new Color();\n        color.R = red;\n        color.G = green;\n        color.B = blue;\n        color.A = 1;\n        return color;\n    };\n    /**\n     * Create a new Color instance base on R,G,B,A channels.\n     *\n     * @param red - Value between 0 and 1.\n     * @param green - Value between 0 and 1.\n     * @param blue - Value between 0 and 1.\n     * @param alpha - Value between 0 and 1.\n     * @returns New instance of Color.\n     */\n    Color.newRGBA = function (red, green, blue, alpha) {\n        var color = new Color();\n        color.R = red;\n        color.G = green;\n        color.B = blue;\n        color.A = alpha;\n        return color;\n    };\n    Color.prototype.toArrayRGB = function () {\n        return [this.R, this.G, this.B];\n    };\n    Color.prototype.toArrayRGBA = function () {\n        return [this.R, this.G, this.B, this.A];\n    };\n    /**\n     * Parse a color writtent in CSS syntax.\n     *\n     * @param code - CSS color.\n     * @returns `true` if the color has valid syntax.\n     */\n    Color.prototype.parse = function (code) {\n        if (code === void 0) { code = '#000000'; }\n        var input = code.trim().toUpperCase();\n        if (this.parseHexa.call(this, input)) {\n            return true;\n        }\n        if (this.parseRGB.call(this, input)) {\n            return true;\n        }\n        if (this.parseRGBA.call(this, input)) {\n            return true;\n        }\n        if (this.parseHSL.call(this, input)) {\n            return true;\n        }\n        // @TODO parseHSLA.\n        return false;\n    };\n    /**\n     * @see https://en.wikipedia.org/wiki/Grayscale\n     * @this Color\n     * @returns {undefined}\n     */\n    Color.prototype.luminance = function () {\n        var LUM_RED = 0.2126;\n        var LUM_GREEN = 0.7152;\n        var LUM_BLUE = 0.0722;\n        return LUM_RED * this.R + LUM_GREEN * this.G + LUM_BLUE * this.B;\n    };\n    /**\n     * @returns {integer} 0 if the color is dark and 1 if it is light.\n     */\n    Color.prototype.luminanceStep = function () {\n        return this.luminance() < LUMINANCE_THRESHOLD ? 0 : 1;\n    };\n    /**\n     * @this Color\n     * @returns String value of the color. `#fd45a7`.\n     */\n    Color.prototype.stringify = function () {\n        var FF = 0xFF;\n        var color = hexa2(this.R * FF) + hexa2(this.G * FF) + hexa2(this.B * FF);\n        if (this.A < 1) {\n            color += hexa2(this.A * FF);\n        }\n        return \"#\" + color;\n    };\n    Color.prototype.copy = function () {\n        var newColor = new Color();\n        newColor.R = this.R;\n        newColor.G = this.G;\n        newColor.B = this.B;\n        newColor.A = this.A;\n        newColor.H = this.H;\n        newColor.S = this.S;\n        newColor.L = this.L;\n        return newColor;\n    };\n    /**\n     * @see https://en.wikipedia.org/wiki/HSL_and_HSV#Converting_to_RGB\n     */\n    Color.prototype.hsl2rgb = function () {\n        var H = 6 * this.H;\n        var S = this.S;\n        var L = this.L;\n        var chroma = (1 - Math.abs(2 * L - 1)) * S;\n        var x = chroma * (1 - Math.abs((H % 2) - 1));\n        var R = 0;\n        var G = 0;\n        var B = 0;\n        if (H < 3) {\n            if (H < 1) {\n                R = chroma;\n                G = x;\n                B = 0;\n            }\n            else if (H < 2) {\n                R = x;\n                G = chroma;\n                B = 0;\n            }\n            else {\n                // H == 2.\n                R = 0;\n                G = chroma;\n                B = x;\n            }\n        }\n        else if (H < 4) {\n            R = 0;\n            G = x;\n            B = chroma;\n        }\n        else if (H < 5) {\n            R = x;\n            G = 0;\n            B = chroma;\n        }\n        else {\n            R = chroma;\n            G = 0;\n            B = x;\n        }\n        var shift = L - chroma * 0.5;\n        this.R = R + shift;\n        this.G = G + shift;\n        this.B = B + shift;\n    };\n    Color.prototype.rgb2hsl = function () {\n        var R = this.R;\n        var G = this.G;\n        var B = this.B;\n        var min = Math.min(R, G, B);\n        var max = Math.max(R, G, B);\n        var delta = max - min;\n        this.L = 0.5 * (max + min);\n        if (delta < 0.000001) {\n            this.H = 0;\n            this.S = 0;\n        }\n        else {\n            this.S = delta / (1 - Math.abs(2 * this.L - 1));\n            if (max === R) {\n                if (G >= B) {\n                    this.H = INV6 * ((G - B) / delta);\n                }\n                else {\n                    this.H = 1 - INV6 * ((B - G) / delta);\n                }\n            }\n            else if (max === G) {\n                this.H = INV6 * (2 + (B - R) / delta);\n            }\n            else {\n                this.H = INV6 * (4 + (R - G) / delta);\n            }\n        }\n    };\n    Color.prototype.parseHexa = function (text) {\n        if (text.charAt(0) !== '#') {\n            return false;\n        }\n        var R = 0;\n        var G = 0;\n        var B = 0;\n        var A = 1;\n        switch (text.length) {\n            case 4:\n                R = parseInt(text.charAt(1), 16) * INV15;\n                G = parseInt(text.charAt(2), 16) * INV15;\n                B = parseInt(text.charAt(3), 16) * INV15;\n                break;\n            case 5:\n                R = parseInt(text.charAt(1), 16) * INV15;\n                G = parseInt(text.charAt(2), 16) * INV15;\n                B = parseInt(text.charAt(3), 16) * INV15;\n                A = parseInt(text.charAt(4), 16) * INV15;\n                break;\n            case 7:\n                R = parseInt(text.substr(1, 2), 16) * INV255;\n                G = parseInt(text.substr(3, 2), 16) * INV255;\n                B = parseInt(text.substr(5, 2), 16) * INV255;\n                break;\n            case 9:\n                R = parseInt(text.substr(1, 2), 16) * INV255;\n                G = parseInt(text.substr(3, 2), 16) * INV255;\n                B = parseInt(text.substr(5, 2), 16) * INV255;\n                A = parseInt(text.substr(7, 2), 16) * INV255;\n                break;\n            default:\n        }\n        if (isNaN(R) || isNaN(G) || isNaN(B) || isNaN(A)) {\n            this.R = this.G = this.B = this.A = 0;\n        }\n        else {\n            this.R = R;\n            this.G = G;\n            this.B = B;\n            this.A = A;\n        }\n        return true;\n    };\n    /**\n     * @param text - `rgb(200, 140, 50)`\n     * @returns `true` if `text` is a valid `rgb()` syntax.\n     */\n    Color.prototype.parseRGB = function (text) {\n        var m = RX_RGB.exec(text);\n        if (!m) {\n            return false;\n        }\n        this.R = clamp01(parseInt(m[1], 10) * INV255);\n        this.G = clamp01(parseInt(m[2], 10) * INV255);\n        this.B = clamp01(parseInt(m[3], 10) * INV255);\n        this.A = 1;\n        return true;\n    };\n    /**\n     * @param text - `rgba(200, 140, 50, 0.5)`\n     * @returns `true` if `text` is a valid `rgba()` syntax.\n     */\n    Color.prototype.parseRGBA = function (text) {\n        var m = RX_RGBA.exec(text);\n        if (!m) {\n            return false;\n        }\n        this.R = clamp01(parseInt(m[1], 10) * INV255);\n        this.G = clamp01(parseInt(m[2], 10) * INV255);\n        this.B = clamp01(parseInt(m[3], 10) * INV255);\n        this.A = clamp01(parseFloat(m[4]));\n        return true;\n    };\n    /**\n     * @param text - `hsl(200, 140, 50)`\n     * @returns `true` if `text` is a valid `hsl()` syntax.\n     */\n    Color.prototype.parseHSL = function (text) {\n        var m = RX_HSL.exec(text);\n        if (!m) {\n            return false;\n        }\n        this.H = clamp01(parseInt(m[1], 10) * INV359);\n        this.S = clamp01(parseInt(m[2], 10) * INV99);\n        this.L = clamp01(parseInt(m[3], 10) * INV99);\n        this.A = 1;\n        this.hsl2rgb();\n        return true;\n    };\n    return Color;\n}());\nexport default Color;\nvar INV6 = 1 / 6;\nvar INV15 = 1 / 15;\nvar INV99 = 1 / 99;\nvar INV255 = 1 / 255;\nvar INV359 = 1 / 359;\nvar RX_RGB = /^RGB[\\s(]+([0-9]+)[^0-9]+([0-9]+)[^0-9]+([0-9]+)/;\nvar RX_RGBA = /^RGBA[\\s(]+([0-9]+)[^0-9]+([0-9]+)[^0-9]+([0-9]+)[^0-9.]+([0-9.]+)/;\nvar RX_HSL = /^HSL[\\s(]+([0-9]+)[^0-9]+([0-9]+)[^0-9]+([0-9]+)/;\nfunction clamp01(value) {\n    if (value < 0) {\n        return 0;\n    }\n    if (value > 1) {\n        return 1;\n    }\n    return value;\n}\nfunction hexa2(value) {\n    var out = Math.floor(value).toString(16);\n    if (out.length < 2) {\n        out = \"0\" + out;\n    }\n    return out;\n}\n//# sourceMappingURL=color.js.map","import { __extends } from \"tslib\";\n/**\n * Clear the screen by filling it with a plain color.\n * This color is defined by attributes red, gree, blue and alpha, which must be between 0 and 1.\n */\nimport Color from '../webgl/color';\nimport Painter from './painter';\nvar ClearPainter = /** @class */ (function (_super) {\n    __extends(ClearPainter, _super);\n    function ClearPainter(params) {\n        var _this = _super.call(this) || this;\n        _this.params = params;\n        _this._red = 0.8;\n        _this._green = 0.4;\n        _this._blue = 0.2;\n        _this._alpha = 1;\n        return _this;\n    }\n    Object.defineProperty(ClearPainter.prototype, \"red\", {\n        get: function () {\n            return this._red;\n        },\n        set: function (v) {\n            this._red = v;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ClearPainter.prototype, \"green\", {\n        get: function () {\n            return this._green;\n        },\n        set: function (v) {\n            this._green = v;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ClearPainter.prototype, \"blue\", {\n        get: function () {\n            return this._blue;\n        },\n        set: function (v) {\n            this._blue = v;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ClearPainter.prototype, \"alpha\", {\n        get: function () {\n            return this._alpha;\n        },\n        set: function (v) {\n            this._alpha = v;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ClearPainter.prototype, \"color\", {\n        get: function () {\n            var color = new Color();\n            color.R = this._red;\n            color.G = this._green;\n            color.B = this._blue;\n            color.A = this._alpha;\n            return color.stringify();\n        },\n        set: function (cssColor) {\n            var color = new Color(cssColor);\n            this._red = color.R;\n            this._green = color.G;\n            this._blue = color.B;\n            this._alpha = color.A;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ClearPainter.prototype.render = function () {\n        var scene = this.scene;\n        if (!scene) {\n            return;\n        }\n        var gl = scene.gl;\n        gl.clearColor(this._red, this._green, this._blue, this._alpha);\n        gl.clear(gl.COLOR_BUFFER_BIT);\n    };\n    ClearPainter.prototype.initialize = function () {\n        if (this.params) {\n            this.color = this.params.color || '#d72';\n        }\n    };\n    ClearPainter.prototype.destroy = function () {\n        // Nothing to destroy for this painter.\n    };\n    return ClearPainter;\n}(Painter));\nexport default ClearPainter;\n//# sourceMappingURL=clear.js.map","/**\n * Sprites management is complex because we must be able to add sprites\n * even for Painters that are not yet used in a Scene.\n */\nimport { __assign } from \"tslib\";\nimport Calc from '../../calc';\nvar Sprite = /** @class */ (function () {\n    function Sprite(id, data, update, destroy, params) {\n        this.extra = {};\n        this.$index = -1;\n        this._id = id;\n        this._data = data;\n        this._update = update;\n        this._destroy = destroy;\n        this._params = params;\n    }\n    Object.defineProperty(Sprite.prototype, \"x\", {\n        get: function () {\n            return this._params.x;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Sprite.prototype, \"y\", {\n        get: function () {\n            return this._params.y;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Sprite.prototype, \"z\", {\n        get: function () {\n            return this._params.z;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Sprite.prototype, \"width\", {\n        get: function () {\n            return this._params.width;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Sprite.prototype, \"height\", {\n        get: function () {\n            return this._params.height;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Sprite.prototype, \"originX\", {\n        get: function () {\n            return this._params.originX;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Sprite.prototype, \"originY\", {\n        get: function () {\n            return this._params.originY;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Sprite.prototype, \"u0\", {\n        get: function () {\n            return this._params.u0;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Sprite.prototype, \"v0\", {\n        get: function () {\n            return this._params.v0;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Sprite.prototype, \"u1\", {\n        get: function () {\n            return this._params.u1;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Sprite.prototype, \"v1\", {\n        get: function () {\n            return this._params.v1;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Sprite.prototype, \"id\", {\n        get: function () { return this._id; },\n        enumerable: true,\n        configurable: true\n    });\n    Sprite.prototype.destroy = function () {\n        this._destroy(this);\n    };\n    Sprite.prototype.update = function (newParams) {\n        if (newParams) {\n            this._params = __assign(__assign({}, this._params), newParams);\n        }\n        var _a = this._params, x = _a.x, y = _a.y, z = _a.z, originX = _a.originX, originY = _a.originY, width = _a.width, height = _a.height, u0 = _a.u0, v0 = _a.v0, u1 = _a.u1, v1 = _a.v1, scale = _a.scale, angle = _a.angle;\n        var xxA = -originX;\n        var yyA = -originY;\n        var xxB = xxA + width;\n        var yyB = yyA;\n        var xxC = xxA + width;\n        var yyC = yyA + height;\n        var xxD = xxA;\n        var yyD = yyA + height;\n        var xA = xxA * scale;\n        var yA = yyA * scale;\n        var xB = xxB * scale;\n        var yB = yyB * scale;\n        var xC = xxC * scale;\n        var yC = yyC * scale;\n        var xD = xxD * scale;\n        var yD = yyD * scale;\n        // tslint:disable-next-line:no-bitwise\n        if ((angle | 0) !== 0) {\n            var C = Calc.cos(angle);\n            var S = Calc.sin(angle);\n            xA = (xxA * C + yyA * S) * scale;\n            yA = (yyA * C - xxA * S) * scale;\n            xB = (xxB * C + yyB * S) * scale;\n            yB = (yyB * C - xxB * S) * scale;\n            xC = (xxC * C + yyC * S) * scale;\n            yC = (yyC * C - xxC * S) * scale;\n            xD = (xxD * C + yyD * S) * scale;\n            yD = (yyD * C - xxD * S) * scale;\n        }\n        var data = this._data;\n        // tslint:disable:no-magic-numbers\n        data[0] = xA + x;\n        data[1] = yA + y;\n        data[2] = z;\n        data[3] = u0;\n        data[4] = v0;\n        data[5] = xB + x;\n        data[6] = yB + y;\n        data[7] = z;\n        data[8] = u1;\n        data[9] = v0;\n        data[10] = xC + x;\n        data[11] = yC + y;\n        data[12] = z;\n        data[13] = u1;\n        data[14] = v1;\n        data[15] = xD + x;\n        data[16] = yD + y;\n        data[17] = z;\n        data[18] = u0;\n        data[19] = v1;\n        // tslint:enable:no-magic-numbers\n        this._update(this, data);\n    };\n    return Sprite;\n}());\nexport default Sprite;\n//# sourceMappingURL=sprite.js.map","import { __assign, __extends, __read, __values } from \"tslib\";\nimport Painter from '../painter';\nimport Sprite from './sprite';\nimport frag from './sprites.frag';\nimport vert from './sprites.vert';\n// Allocations will be done by pieces of BLOCK Sprites.\nvar BLOCK = 64;\nvar NB_ATTRIBS = 6; // attXYZ and attUV and attAngle.\nvar NB_CORNERS = 4;\nvar CHUNK = NB_ATTRIBS * NB_CORNERS;\nvar DEFAULT_WIDTH = 64;\nvar DEFAULT_HEIGHT = 64;\nvar HALF = 0.5;\nvar globalID = 1;\nvar SpritesPainter = /** @class */ (function (_super) {\n    __extends(SpritesPainter, _super);\n    function SpritesPainter(params) {\n        var _this = _super.call(this) || this;\n        _this._capacity = BLOCK;\n        _this._dataVert = new Float32Array(BLOCK * CHUNK);\n        // We need to keep track of all the inserted sprites because when we want to destroy\n        // one, we wnat to exchange its position with the one at the end of the list for\n        // optimisation purpose.\n        _this._sprites = [];\n        _this._update = function (sprite, data) {\n            if (!_this.scene) {\n                // If this painter has not yet been initialized, then update has to be defered.\n                _this._deferedSpritesUpdate.set(sprite.id, [sprite, data]);\n                return;\n            }\n            if (sprite.$index < 0) {\n                _this._allocate(sprite);\n            }\n            _this._dataVert.set(data, CHUNK * sprite.$index);\n        };\n        /**\n         * Only called by an instance os Sprite.\n         */\n        _this._destroy = function (sprite) {\n            var lastSprite = _this._sprites.pop();\n            if (!lastSprite) {\n                console.error(\"You tried to destroy a Sprite that is not owned by this painter!\", sprite);\n                return;\n            }\n            var indexOfLastSprite = lastSprite.$index;\n            if (indexOfLastSprite !== sprite.$index) {\n                // Swap positions of destroyed sprite and last sprite in the list.\n                lastSprite.$index = sprite.$index;\n                _this._sprites[lastSprite.$index] = lastSprite;\n                lastSprite.update();\n            }\n            sprite.$index = -1;\n        };\n        _this._atlas = params.atlas;\n        _this._deferedSpritesUpdate = new Map();\n        return _this;\n    }\n    Object.defineProperty(SpritesPainter.prototype, \"atlas\", {\n        get: function () {\n            return this._atlas;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(SpritesPainter.prototype, \"count\", {\n        get: function () {\n            return this._sprites.length;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * Register a new sprite that will be immediatly visible.\n     */\n    SpritesPainter.prototype.create = function (params) {\n        var atlas = this.atlas;\n        var width = atlas.width || DEFAULT_WIDTH;\n        var height = atlas.height || DEFAULT_HEIGHT;\n        var data = new Float32Array(CHUNK);\n        var sprite = new Sprite(\"\" + globalID++, data, this._update, this._destroy, __assign({ x: 0, y: 0, z: 0, width: width, height: height, originX: width * HALF, originY: width * HALF, u0: 0, v0: 0, u1: 1, v1: 1, scale: 1, angle: 0 }, params));\n        sprite.update();\n        return sprite;\n    };\n    /**\n     * Only called by an instance os Sprite.\n     */\n    SpritesPainter.prototype._allocate = function (sprite) {\n        if (this._capacity <= this.count) {\n            this._allocateNewBlock();\n        }\n        sprite.$index = this.count;\n        this._sprites.push(sprite);\n    };\n    /**\n     * When the number of sprites exceeds the current capacity, we must allocate a new BLOCK.\n     * This function cannot be called before painter initialization.\n     */\n    SpritesPainter.prototype._allocateNewBlock = function () {\n        this._capacity += BLOCK;\n        var _a = this, scene = _a.scene, _buffElem = _a._buffElem;\n        if (!scene) {\n            throw Error('No scene!');\n        }\n        if (!_buffElem) {\n            throw Error('No buffElem!');\n        }\n        var gl = scene.gl;\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, _buffElem);\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, createElements(this._capacity), gl.DYNAMIC_DRAW);\n        var dataVert = new Float32Array(this._capacity * CHUNK);\n        dataVert.set(this._dataVert);\n        this._dataVert = dataVert;\n    };\n    SpritesPainter.prototype.render = function () {\n        var _a = this, scene = _a.scene, _prg = _a._prg, atlas = _a.atlas, _buffVert = _a._buffVert, _buffElem = _a._buffElem;\n        if (!scene || !_prg || !atlas || !_buffVert || !_buffElem) {\n            return;\n        }\n        var gl = scene.gl;\n        // Update sprites' attributes.\n        gl.bindBuffer(gl.ARRAY_BUFFER, _buffVert);\n        gl.bufferData(gl.ARRAY_BUFFER, this._dataVert, gl.DYNAMIC_DRAW);\n        gl.enable(gl.DEPTH_TEST);\n        _prg.use();\n        atlas.activate();\n        var uniforms = _prg;\n        uniforms.$uniTexture = 0;\n        uniforms.$uniWidth = scene.width;\n        uniforms.$uniHeight = scene.height;\n        _prg.bindAttribs(_buffVert, 'attXYZ', 'attUV');\n        gl.bindBuffer(gl.ARRAY_BUFFER, _buffVert);\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, _buffElem);\n        gl.drawElements(gl.TRIANGLES, NB_ATTRIBS * this.count, gl.UNSIGNED_SHORT, 0);\n    };\n    SpritesPainter.prototype.initialize = function (scene) {\n        this._prg = this.createProgram({ vert: vert, frag: frag });\n        var gl = scene.gl;\n        var buffVert = gl.createBuffer();\n        if (!buffVert) {\n            throw this.fatal('Not enough memory to create an array buffer!');\n        }\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffVert);\n        gl.bufferData(gl.ARRAY_BUFFER, this._dataVert, gl.DYNAMIC_DRAW);\n        this._buffVert = buffVert;\n        var buffElem = gl.createBuffer();\n        if (!buffElem) {\n            throw this.fatal('Not enough memory to create an array buffer!');\n        }\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffElem);\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, createElements(BLOCK), gl.DYNAMIC_DRAW);\n        this._buffElem = buffElem;\n        this.manageDeferedSpritesUpdates();\n    };\n    SpritesPainter.prototype.destroy = function () {\n        var _a = this, scene = _a.scene, _buffVert = _a._buffVert, _buffElem = _a._buffElem;\n        if (!scene || !_buffVert || !_buffElem) {\n            return;\n        }\n        var gl = scene.gl;\n        gl.deleteBuffer(_buffVert);\n        gl.deleteBuffer(_buffElem);\n    };\n    SpritesPainter.prototype.manageDeferedSpritesUpdates = function () {\n        var e_1, _a;\n        if (this._deferedSpritesUpdate.size === 0) {\n            // Nothing to do.\n            return;\n        }\n        try {\n            for (var _b = __values(this._deferedSpritesUpdate.values()), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var item = _c.value;\n                var _d = __read(item, 2), sprite = _d[0], data = _d[1];\n                this._update(sprite, data);\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n    };\n    return SpritesPainter;\n}(Painter));\nexport default SpritesPainter;\nvar CORNER_B = 1;\nvar CORNER_C = 2;\nvar CORNER_D = 3;\n/**\n * A--B\n * |  |\n * D--C\n */\nfunction createElements(capacity) {\n    var dataElem = new Uint16Array(NB_ATTRIBS * capacity);\n    var i = 0;\n    var a = 0;\n    for (var k = 0; k < capacity; k++) {\n        var b = a + CORNER_B;\n        var c = a + CORNER_C;\n        var d = a + CORNER_D;\n        // tslint:disable:no-magic-numbers\n        dataElem[i + 0] = a;\n        dataElem[i + 1] = d;\n        dataElem[i + 2] = b;\n        dataElem[i + 3] = b;\n        dataElem[i + 4] = d;\n        dataElem[i + 5] = c;\n        // tslint:enable:no-magic-numbers\n        a += NB_CORNERS;\n        i += NB_ATTRIBS;\n    }\n    return dataElem;\n}\n//# sourceMappingURL=sprites.js.map","uniform float uniWidth;\nuniform float uniHeight;\nattribute vec3 attXYZ;\nattribute vec2 attUV;\nvarying vec2 varUV;\n\nconst float RESOLUTION = 512.0;\nconst float INV_RESOLUTION = 1.0 / RESOLUTION;\n\nvoid main() {\n  varUV = attUV;\n  float widestSide = max(uniWidth, uniHeight);\n  float w = widestSide / uniWidth;\n  float h = widestSide / uniHeight;\n  float x = w * (attXYZ.x - RESOLUTION) * INV_RESOLUTION;\n  float y = h * (attXYZ.y - RESOLUTION) * INV_RESOLUTION;\n\n  gl_Position = vec4(x, -y, attXYZ.z, 1.0);\n}\n","precision mediump float;\nuniform sampler2D uniTexture;\nvarying vec2 varUV;\n\nvoid main() {\n  vec4 color = texture2D( uniTexture, varUV );\n  if (color.a < 1.0) discard;\n  gl_FragColor = color;\n}\n","import BackgroundPainter from './background';\nimport ClearPainter from './clear';\nimport Painter from './painter';\nimport SpritesPainter from './sprites';\nexport default {\n    Background: BackgroundPainter,\n    Clear: ClearPainter,\n    Painter: Painter,\n    Sprites: SpritesPainter,\n};\n//# sourceMappingURL=index.js.map","import { __awaiter, __generator } from \"tslib\";\nvar Atlas = /** @class */ (function () {\n    function Atlas(gl, _name) {\n        this.gl = gl;\n        this._name = _name;\n        this._ready = false;\n        this._width = 0;\n        this._height = 0;\n        var texture = gl.createTexture();\n        if (!texture) {\n            throw new Error('Unable to create a new texture!');\n        }\n        this.texture = texture;\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n    }\n    Object.defineProperty(Atlas.prototype, \"name\", {\n        get: function () {\n            return this._name;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Atlas.prototype, \"width\", {\n        get: function () {\n            return this._width;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Atlas.prototype, \"height\", {\n        get: function () {\n            return this._height;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Atlas.prototype, \"ready\", {\n        /**\n         * Return `true` as soon as an image has been loaded into the graphic card.\n         */\n        get: function () {\n            return this._ready;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * Remove the texture from the graphic card memory.\n     */\n    Atlas.prototype.destroy = function () {\n        this._ready = false;\n        var _a = this, gl = _a.gl, texture = _a.texture;\n        gl.deleteTexture(texture);\n    };\n    Atlas.prototype.activate = function (unit) {\n        if (unit === void 0) { unit = 0; }\n        var _a = this, gl = _a.gl, texture = _a.texture;\n        var UNITS = [\n            gl.TEXTURE0,\n            gl.TEXTURE1,\n            gl.TEXTURE2,\n            gl.TEXTURE3,\n            gl.TEXTURE4,\n            gl.TEXTURE5,\n            gl.TEXTURE6,\n            gl.TEXTURE7,\n        ];\n        gl.activeTexture(UNITS[Math.abs(unit) % UNITS.length]);\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n    };\n    Atlas.prototype.load = function (params) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                this._ready = false;\n                return [2 /*return*/, this.loadImage(params.image)];\n            });\n        });\n    };\n    Atlas.prototype.loadImage = function (url) {\n        return __awaiter(this, void 0, void 0, function () {\n            var that;\n            return __generator(this, function (_a) {\n                that = this;\n                return [2 /*return*/, new Promise(function (resolve, reject) {\n                        var img = new Image();\n                        that._ready = false;\n                        img.onload = function () {\n                            var gl = that.gl, texture = that.texture;\n                            gl.bindTexture(gl.TEXTURE_2D, texture);\n                            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, img);\n                            that._ready = true;\n                            that._width = img.width;\n                            that._height = img.height;\n                            resolve();\n                        };\n                        img.onerror = function () {\n                            console.error(\"Unable to load image \\\"\" + name + \"\\\": \", url);\n                            reject();\n                        };\n                        img.src = url;\n                    })];\n            });\n        });\n    };\n    return Atlas;\n}());\nexport default Atlas;\n//# sourceMappingURL=atlas.js.map","var VIRTUAL_SCREEN_RESOLUTION = 1024;\nvar HALF = 0.5;\nvar Pointer = /** @class */ (function () {\n    /** @hidden */\n    function Pointer(canvas) {\n        var _this = this;\n        this._x = 0;\n        this._y = 0;\n        this._down = false;\n        // If 0, pointer is up.\n        this._downTime = 0;\n        this._eventDown = false;\n        this._eventUp = false;\n        this.onMouseMove = function (evt) {\n            _this.computeCoords(evt.clientX, evt.clientY);\n        };\n        this.onTouchMove = function (te) {\n            var evt = te.touches[0];\n            _this.computeCoords(evt.clientX, evt.clientY);\n        };\n        this.onMouseDown = function (evt) {\n            _this.onDown(evt.clientX, evt.clientY);\n        };\n        this.onTouchStart = function (te) {\n            var evt = te.touches[0];\n            _this.onDown(evt.clientX, evt.clientY);\n        };\n        this.onMouseUp = function (evt) {\n            _this.onUp(evt.clientX, evt.clientY);\n        };\n        this.onTouchEnd = function (te) {\n            var evt = te.touches[0];\n            _this.onUp(evt.clientX, evt.clientY);\n        };\n        this.canvas = canvas;\n        window.addEventListener('mousemove', this.onMouseMove, true);\n        window.addEventListener('touchmove', this.onTouchMove, true);\n        window.addEventListener('mousedown', this.onMouseDown, true);\n        window.addEventListener('touchstart', this.onTouchStart, true);\n        window.addEventListener('mouseup', this.onMouseUp, true);\n        window.addEventListener('touchend', this.onTouchEnd, true);\n    }\n    /** @hidden */\n    Pointer.prototype.reset = function () {\n        this._eventDown = false;\n        this._eventUp = false;\n    };\n    Object.defineProperty(Pointer.prototype, \"x\", {\n        get: function () {\n            return this._x;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Pointer.prototype, \"y\", {\n        get: function () {\n            return this._y;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Pointer.prototype, \"down\", {\n        /** Test if the pointer is touching the screen. */\n        get: function () {\n            return this._down;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Pointer.prototype, \"eventUp\", {\n        /** `true` only if the pointer started touching the screen this very last frame. */\n        get: function () {\n            return this._eventUp;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Pointer.prototype, \"eventDown\", {\n        /** `true` only if the pointer stopped touching the screen this very last frame. */\n        get: function () {\n            return this._eventDown;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Pointer.prototype.onDown = function (x, y) {\n        if (this._downTime !== 0) {\n            return;\n        }\n        this.computeCoords(x, y);\n        this._down = true;\n        this._eventDown = true;\n        this._downTime = Date.now();\n    };\n    Pointer.prototype.onUp = function (x, y) {\n        if (this._downTime === 0) {\n            return;\n        }\n        this.computeCoords(x, y);\n        this._down = false;\n        this._eventUp = true;\n        this._downTime = 0;\n    };\n    Pointer.prototype.computeCoords = function (pointerX, pointerY) {\n        var canvas = this.canvas;\n        var rect = canvas.getBoundingClientRect();\n        var x = pointerX - rect.left;\n        var y = pointerY - rect.top;\n        var w = rect.width;\n        var h = rect.height;\n        if (w > h) {\n            this._x = (VIRTUAL_SCREEN_RESOLUTION * x) / w;\n            this._y = VIRTUAL_SCREEN_RESOLUTION * (HALF * (1 - h / w) + y / w);\n        }\n        else {\n            this._x = VIRTUAL_SCREEN_RESOLUTION * (HALF * (1 - w / h) + x / h);\n            this._y = (VIRTUAL_SCREEN_RESOLUTION * y) / h;\n        }\n    };\n    return Pointer;\n}());\nexport default Pointer;\n//# sourceMappingURL=pointer.js.map","/**\n * Resolution in CSS pixels. If omitted, the real resolution\n * of the device is taken. On smartphones, for instance,\n * the resolution is often greater than 1.\n *\n * Return `true` if the size has changed.\n */\nexport default (function (gl, _resolution) {\n    if (_resolution === void 0) { _resolution = 0; }\n    var resolution = _resolution <= 0 ? window.devicePixelRatio : _resolution;\n    var canvas = gl.canvas;\n    if (canvas instanceof HTMLCanvasElement) {\n        var displayWidth = Math.floor(canvas.clientWidth * resolution);\n        var displayHeight = Math.floor(canvas.clientHeight * resolution);\n        // Check if the canvas is not the same size.\n        if (canvas.width !== displayWidth || canvas.height !== displayHeight) {\n            // Make the canvas the same size\n            canvas.width = displayWidth;\n            canvas.height = displayHeight;\n            gl.viewport(0, 0, displayWidth, displayHeight);\n            return true;\n        }\n    }\n    return false;\n});\n//# sourceMappingURL=resize.js.map","import { __values } from \"tslib\";\nimport Atlas from './atlas';\nimport Pointer from './pointer';\nimport Resize from './webgl/resize';\nvar ID = 1;\nvar Scene = /** @class */ (function () {\n    function Scene(canvas) {\n        var _this = this;\n        this.resolution = 1;\n        this.onAnimation = null;\n        this.activePainters = [];\n        this.isRendering = false;\n        this._pointerTap = false;\n        this.render = function (time) {\n            var e_1, _a;\n            if (_this.isRendering) {\n                window.requestAnimationFrame(_this.render);\n            }\n            else {\n                return;\n            }\n            var gl = _this.gl;\n            Resize(gl, _this.resolution);\n            gl.clearDepth(-1);\n            gl.clear(gl.DEPTH_BUFFER_BIT);\n            gl.depthFunc(gl.GEQUAL);\n            try {\n                try {\n                    for (var _b = __values(_this.activePainters), _c = _b.next(); !_c.done; _c = _b.next()) {\n                        var painter = _c.value;\n                        painter.render(time);\n                    }\n                }\n                catch (e_1_1) { e_1 = { error: e_1_1 }; }\n                finally {\n                    try {\n                        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n                    }\n                    finally { if (e_1) throw e_1.error; }\n                }\n                var onAnimation = _this.onAnimation;\n                if (typeof onAnimation === 'function') {\n                    onAnimation(time);\n                    _this.pointer.reset();\n                }\n            }\n            catch (ex) {\n                console.error(ex);\n                _this.stop();\n                console.error('###############################');\n                console.error('# Rendering has been stopped! #');\n                console.error('###############################');\n            }\n        };\n        this._pointer = new Pointer(canvas);\n        var gl = canvas.getContext('webgl', {\n        // Specify WebGL options.\n        });\n        if (!gl) {\n            throw new Error('Unable to create a WegGL context!');\n        }\n        this._gl = gl;\n        this.atlases = new Map();\n    }\n    Object.defineProperty(Scene.prototype, \"gl\", {\n        get: function () {\n            return this._gl;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Scene.prototype, \"pointer\", {\n        /**\n         * Retreive information about pointer (mouse, pen, finger, ...) state.\n         */\n        get: function () {\n            return this._pointer;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Scene.prototype, \"width\", {\n        /**\n         * Visible width. Between 0 and 1024.\n         */\n        get: function () {\n            return this.gl.drawingBufferWidth;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Scene.prototype, \"height\", {\n        /**\n         * Visible height. Between 0 and 1024.\n         */\n        get: function () {\n            return this.gl.drawingBufferHeight;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Scene.prototype, \"pointerTap\", {\n        get: function () {\n            return this._pointerTap;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * Define which painter to use and in what order.\n     * For better performance, prefer putting background painters at the end of the list.\n     */\n    Scene.prototype.use = function (painters) {\n        var e_2, _a;\n        try {\n            for (var painters_1 = __values(painters), painters_1_1 = painters_1.next(); !painters_1_1.done; painters_1_1 = painters_1.next()) {\n                var painter = painters_1_1.value;\n                painter.scene = this;\n            }\n        }\n        catch (e_2_1) { e_2 = { error: e_2_1 }; }\n        finally {\n            try {\n                if (painters_1_1 && !painters_1_1.done && (_a = painters_1.return)) _a.call(painters_1);\n            }\n            finally { if (e_2) throw e_2.error; }\n        }\n        this.activePainters = painters.slice();\n    };\n    Scene.prototype.getAtlas = function (name) {\n        var atlases = this.atlases;\n        return atlases.get(name) || null;\n    };\n    /**\n     * Create an atlas that can be used immediatly even if the needed assets are not yet loaded.\n     * @param  params\n     * @param  onLoad You can provide a callback function that will be called when the assets\n     * are loaded.\n     */\n    Scene.prototype.createAtlas = function (params, onLoad) {\n        var name = params.name;\n        var sanitizedName = name || this.getNewName();\n        var atlas = new Atlas(this.gl, sanitizedName);\n        this.atlases.set(sanitizedName, atlas);\n        // tslint:disable:no-floating-promises\n        atlas.load(params).then(function () {\n            if (typeof onLoad === 'function') {\n                onLoad(params);\n            }\n        });\n        return atlas;\n    };\n    Scene.prototype.destroyAtlas = function (name) {\n        var atlases = this.atlases;\n        var atlas = atlases.get(name);\n        if (!atlas) {\n            return false;\n        }\n        atlases.delete(name);\n        atlas.destroy();\n        return true;\n    };\n    /**\n     * Start rendering.\n     * When a frame is rendered, the function `onAnimation( time: number )` is called.\n     */\n    Scene.prototype.start = function () {\n        if (this.isRendering) {\n            return;\n        }\n        this.isRendering = true;\n        window.requestAnimationFrame(this.render);\n    };\n    /**\n     * Stop rendering.\n     */\n    Scene.prototype.stop = function () {\n        this.isRendering = false;\n    };\n    Scene.prototype.getNewName = function () {\n        while (true) {\n            var name_1 = \"atlas-\" + ID++;\n            if (!this.atlases.has(name_1)) {\n                return name_1;\n            }\n        }\n    };\n    return Scene;\n}());\nexport default Scene;\n//# sourceMappingURL=scene.js.map","import Calc from './calc';\nimport Painter from './painter';\nimport Scene from './scene';\nexport default {\n    Calc: Calc,\n    Painter: Painter,\n    Scene: Scene\n};\n//# sourceMappingURL=index.js.map"],"names":["MODULO","FULL_TURN","COS","Float32Array","SIN","i","angle","Math","PI","cos","sin","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","this","constructor","prototype","create","__assign","assign","t","s","n","arguments","length","call","apply","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","v","op","TypeError","pop","push","__values","o","m","__read","r","ar","error","castString","defaultValue","isNaN","BPE","BYTES_PER_ELEMENT","Program","gl","_codes","includes","codes","vert","parseInclude","frag","parseIncludes","freeze","_typesNamesLookup","lookup","k","toUpperCase","getTypesNamesLookup","shaderProgram","createProgram","Error","program","vertShader","code","getShader","VERTEX_SHADER","getVertexShader","attachShader","fragShader","FRAGMENT_SHADER","getFragmentShader","linkProgram","use","useProgram","attribs","createAttributes","uniforms","createUniforms","getTypeName","typeId","bindAttribs","buffer","e_1","_a","e_2","_b","names","_i","that","bindBuffer","ARRAY_BUFFER","totalSize","names_1","names_1_1","name_1","attrib","keys","map","join","String","size","e_1_1","offset","names_2","names_2_1","name_2","enableVertexAttribArray","location","vertexAttribPointer","FLOAT","e_2_1","setUniform","name","attribsCount","getProgramParameter","ACTIVE_ATTRIBUTES","index","item","getActiveAttrib","typeName","type","getSize","getAttribLocation","defineProperty","writable","enumerable","configurable","FLOAT_VEC4","FLOAT_VEC3","FLOAT_VEC2","uniformsCount","ACTIVE_UNIFORMS","getActiveUniform","location_1","getUniformLocation","set","createUniformSetter","get","createUniformGetter","nameGL","nameJS","BYTE","UNSIGNED_BYTE","SHORT","UNSIGNED_SHORT","INT","UNSIGNED_INT","SAMPLER_2D","uniform1i","uniform1iv","uniform1f","uniform1fv","uniform2fv","uniform3fv","uniform4fv","FLOAT_MAT3","uniformMatrix3fv","FLOAT_MAT4","uniformMatrix4fv","split","line","trim","startsWith","pos","indexOf","includeName","substr","charAt","snippet","console","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","info","Painter","_programs","_scene","scene","internalDestroy","initialize","shaders","prg","fatal","message","_c","deleteProgram","BackgroundPainter","_super","params","_this","render","atlas","buff","enable","DEPTH_TEST","activate","$uniTexture","width","height","drawArrays","TRIANGLE_STRIP","destroy","deleteBuffer","FRAG","getVert","align","createBuffer","bufferData","STATIC_DRAW","x","CODE_CSS_LENGTHS","RX_HEX_COLOR","Color","codeCSS","R","G","B","H","S","L","A","parse","isValid","lastIndex","test","CODE_CSS_LENGTHS_1","CODE_CSS_LENGTHS_1_1","len","normalize","stringify","luminance","luminanceStep","fromArrayRGB","rgb","newRGB","fromArrayRGBA","rgba","newRGBA","mix","color1","color2","alpha","beta","ramp","colors","newBlack","spacesCount","firstColorIndex","floor","translatedAlpha","newWhite","red","green","blue","color","toArrayRGB","toArrayRGBA","input","parseHexa","parseRGB","parseRGBA","parseHSL","hexa2","copy","newColor","hsl2rgb","chroma","abs","shift","rgb2hsl","min","max","delta","INV6","text","parseInt","INV15","INV255","RX_RGB","exec","clamp01","RX_RGBA","parseFloat","RX_HSL","INV359","INV99","out","toString","ClearPainter","_red","_green","_blue","_alpha","cssColor","clearColor","clear","COLOR_BUFFER_BIT","Sprite","id","data","update","extra","$index","_id","_data","_update","_destroy","_params","z","originX","originY","u0","v0","u1","v1","newParams","scale","xxA","yyA","xxB","yyB","xxC","yyC","xxD","yyD","xA","yA","xB","yB","xC","yC","xD","yD","C","Calc","BLOCK","NB_ATTRIBS","NB_CORNERS","CHUNK","globalID","SpritesPainter","_capacity","_dataVert","_sprites","sprite","_allocate","_deferedSpritesUpdate","lastSprite","_atlas","Map","count","_allocateNewBlock","_buffElem","ELEMENT_ARRAY_BUFFER","createElements","DYNAMIC_DRAW","dataVert","_prg","_buffVert","$uniWidth","$uniHeight","drawElements","TRIANGLES","buffVert","buffElem","manageDeferedSpritesUpdates","values","_d","CORNER_B","CORNER_C","CORNER_D","capacity","dataElem","Uint16Array","a","c","Background","Clear","Sprites","Atlas","_name","_ready","_width","_height","texture","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_MAG_FILTER","deleteTexture","unit","UNITS","TEXTURE0","TEXTURE1","TEXTURE2","TEXTURE3","TEXTURE4","TEXTURE5","TEXTURE6","TEXTURE7","activeTexture","load","loadImage","image","url","img","Image","onload","texImage2D","RGBA","onerror","src","Pointer","canvas","_x","_y","_down","_downTime","_eventDown","_eventUp","onMouseMove","evt","computeCoords","clientX","clientY","onTouchMove","te","touches","onMouseDown","onDown","onTouchStart","onMouseUp","onUp","onTouchEnd","window","addEventListener","reset","Date","now","pointerX","pointerY","rect","getBoundingClientRect","left","top","w","h","_resolution","resolution","devicePixelRatio","HTMLCanvasElement","displayWidth","clientWidth","displayHeight","clientHeight","viewport","ID","Scene","onAnimation","activePainters","isRendering","_pointerTap","time","requestAnimationFrame","Resize","clearDepth","DEPTH_BUFFER_BIT","depthFunc","GEQUAL","pointer","ex","stop","_pointer","getContext","_gl","atlases","drawingBufferWidth","drawingBufferHeight","painters","painters_1","painters_1_1","slice","getAtlas","createAtlas","onLoad","sanitizedName","getNewName","destroyAtlas","delete","start","has"],"mappings":"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"}